<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2Up Bet Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ios-blue': '#0671e3',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-md mx-auto">
        <h1 class="text-2xl font-semibold text-gray-900 text-center mb-6">2Up Tracker</h1>
        
        <!-- Add New Bet Form -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-6">
            <div class="space-y-3">
                <input type="text" id="matchName" class="w-full p-4 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-ios-blue focus:bg-white transition-all" placeholder="Team/Match">
                
                <input type="number" id="backStake" class="w-full p-4 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-ios-blue focus:bg-white transition-all" placeholder="Back Stake (£)" step="0.01">
                
                <input type="number" id="bookieOdds" class="w-full p-4 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-ios-blue focus:bg-white transition-all" placeholder="Bookie Odds" step="0.01">
                
                <input type="number" id="exchangeOdds" class="w-full p-4 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:ring-2 focus:ring-ios-blue focus:bg-white transition-all" placeholder="Exchange Lay Odds" step="0.01">
            </div>
            
            <div class="mt-4 p-3 bg-gray-50 rounded-xl">
                <div class="space-y-1 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Lay Stake:</span>
                        <span id="layStake" class="font-medium text-ios-blue">£0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Liability:</span>
                        <span id="liability" class="font-medium text-red-500">£0.00</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Qualifying Loss:</span>
                        <span id="qualifyingLoss" class="font-medium text-orange-500">£0.00</span>
                    </div>
                </div>
            </div>
            
            <button onclick="addBet()" class="w-full mt-4 bg-ios-blue text-white font-medium py-4 rounded-xl transition-all active:scale-95">
                Add Bet
            </button>
        </div>
        
        <!-- Active Bets -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Your Bets</h2>
            <div id="betsList" class="space-y-3">
                <p class="text-gray-500 text-center py-8 text-sm">No bets yet</p>
            </div>
        </div>
        
        <!-- Summary Stats -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Summary</h2>
            <div class="grid grid-cols-2 gap-3">
                <div class="text-center p-3 bg-gray-50 rounded-xl">
                    <div class="text-xl font-semibold text-gray-900" id="totalBets">0</div>
                    <div class="text-xs text-gray-600">Total</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded-xl">
                    <div class="text-xl font-semibold text-gray-900" id="completedBets">0</div>
                    <div class="text-xs text-gray-600">Completed</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded-xl">
                    <div class="text-xl font-semibold text-orange-500" id="totalQualifyingLoss">£0.00</div>
                    <div class="text-xs text-gray-600">Qualifying Loss</div>
                </div>
                <div class="text-center p-3 bg-gray-50 rounded-xl">
                    <div class="text-xl font-semibold text-ios-blue" id="totalProfit">£0.00</div>
                    <div class="text-xs text-gray-600">Total Profit</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let bets = JSON.parse(localStorage.getItem('2upBets')) || [];
        let betIdCounter = parseInt(localStorage.getItem('betIdCounter')) || 1;

        function calculateValues() {
            const backStake = parseFloat(document.getElementById('backStake').value) || 0;
            const bookieOdds = parseFloat(document.getElementById('bookieOdds').value) || 0;
            const exchangeOdds = parseFloat(document.getElementById('exchangeOdds').value) || 0;

            if (backStake && bookieOdds && exchangeOdds) {
                // Calculate lay stake (back stake * bookie odds / exchange odds)
                const layStake = (backStake * bookieOdds) / exchangeOdds;
                
                // Calculate liability (lay stake * (exchange odds - 1))
                const liability = layStake * (exchangeOdds - 1);
                
                // Calculate qualifying loss: if back wins (+backStake*(bookieOdds-1)) and lay loses (-liability), net loss is liability - backStake*(bookieOdds-1)
                const backWin = backStake * (bookieOdds - 1);
                const qualifyingLoss = liability - backWin;

                document.getElementById('layStake').textContent = `£${layStake.toFixed(2)}`;
                document.getElementById('liability').textContent = `£${liability.toFixed(2)}`;
                document.getElementById('qualifyingLoss').textContent = `£${qualifyingLoss.toFixed(2)}`;
            } else {
                document.getElementById('layStake').textContent = '£0.00';
                document.getElementById('liability').textContent = '£0.00';
                document.getElementById('qualifyingLoss').textContent = '£0.00';
            }
        }

        function addBet() {
            const matchName = document.getElementById('matchName').value;
            const backStake = parseFloat(document.getElementById('backStake').value);
            const bookieOdds = parseFloat(document.getElementById('bookieOdds').value);
            const exchangeOdds = parseFloat(document.getElementById('exchangeOdds').value);

            if (!matchName || !backStake || !bookieOdds || !exchangeOdds) {
                alert('Please fill in all fields');
                return;
            }

            const layStake = (backStake * bookieOdds) / exchangeOdds;
            const liability = layStake * (exchangeOdds - 1);
            const backWin = backStake * (bookieOdds - 1);
            const qualifyingLoss = liability - backWin;

            const bet = {
                id: betIdCounter++,
                matchName,
                backStake,
                bookieOdds,
                exchangeOdds,
                layStake,
                liability,
                qualifyingLoss,
                status: 'waiting', // waiting, triggered, completed
                dateAdded: new Date().toLocaleDateString(),
                closeBookieOdds: null,
                closeExchangeOdds: null,
                profit: null
            };

            bets.push(bet);
            localStorage.setItem('2upBets', JSON.stringify(bets));
            localStorage.setItem('betIdCounter', betIdCounter.toString());

            // Clear form
            document.getElementById('matchName').value = '';
            document.getElementById('backStake').value = '';
            document.getElementById('bookieOdds').value = '';
            document.getElementById('exchangeOdds').value = '';
            calculateValues();

            renderBets();
            updateSummary();
        }

        function updateBetStatus(betId, newStatus) {
            const bet = bets.find(b => b.id === betId);
            if (bet) {
                bet.status = newStatus;
                
                // If marking as unsuccessful, set the profit to the negative qualifying loss
                if (newStatus === 'unsuccessful') {
                    bet.profit = -bet.qualifyingLoss;
                }
                
                localStorage.setItem('2upBets', JSON.stringify(bets));
                renderBets();
                updateSummary();
            }
        }

        function closeBet(betId) {
            const closeExchangeOdds = parseFloat(document.getElementById(`closeExchangeOdds${betId}`).value);

            if (!closeExchangeOdds) {
                alert('Please enter the exchange back odds');
                return;
            }

            const bet = bets.find(b => b.id === betId);
            if (bet) {
                bet.closeBookieOdds = bet.bookieOdds; // Bookie odds don't change - bet already won
                bet.closeExchangeOdds = closeExchangeOdds;
                bet.status = 'completed';

                // Calculate profit correctly:
                const backWin = bet.backStake * (bet.bookieOdds - 1); // Original back bet profit
                
                // Calculate exchange back stake: (back stake × back odds) ÷ exchange back odds
                const totalReturn = bet.backStake * bet.bookieOdds; // £10 × 1.2 = £12
                const exchangeBackStake = totalReturn / closeExchangeOdds; // £12 ÷ 1.4 = £8.57
                
                // Exchange profit = lay stake - exchange back stake
                const exchangeProfit = bet.layStake - exchangeBackStake; // £9.23 - £8.57 = £0.66
                
                bet.profit = backWin + exchangeProfit;

                localStorage.setItem('2upBets', JSON.stringify(bets));
                renderBets();
                updateSummary();
            }
        }

        function deleteBet(betId) {
            if (confirm('Are you sure you want to delete this bet?')) {
                bets = bets.filter(b => b.id !== betId);
                localStorage.setItem('2upBets', JSON.stringify(bets));
                renderBets();
                updateSummary();
            }
        }

        function renderBets() {
            const betsList = document.getElementById('betsList');
            
            if (bets.length === 0) {
                betsList.innerHTML = '<p class="text-gray-500 text-center py-8">No bets added yet. Add your first bet above!</p>';
                return;
            }

            betsList.innerHTML = bets.map(bet => `
                <div class="bg-gray-50 rounded-xl p-4 ${bet.status === 'completed' ? 'border-l-4 border-green-500' : bet.status === 'triggered' ? 'border-l-4 border-yellow-500' : bet.status === 'unsuccessful' ? 'border-l-4 border-red-500' : 'border-l-4 border-ios-blue'}">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-medium text-gray-900">${bet.matchName}</h3>
                        <div class="flex gap-2 items-center">
                            <span class="px-2 py-1 text-xs rounded-full ${
                                bet.status === 'waiting' ? 'bg-ios-blue bg-opacity-10 text-ios-blue' :
                                bet.status === 'triggered' ? 'bg-yellow-100 text-yellow-700' :
                                bet.status === 'unsuccessful' ? 'bg-red-100 text-red-700' :
                                'bg-green-100 text-green-700'
                            }">${bet.status.charAt(0).toUpperCase() + bet.status.slice(1)}</span>
                            <button onclick="deleteBet(${bet.id})" class="text-red-500 text-xs">×</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Back:</span>
                                <span class="font-medium">£${bet.backStake.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Odds:</span>
                                <span class="font-medium">${bet.bookieOdds}</span>
                            </div>
                        </div>
                        <div class="space-y-1">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Lay:</span>
                                <span class="font-medium">£${bet.layStake.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Loss:</span>
                                <span class="font-medium text-orange-500">£${bet.qualifyingLoss.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    ${bet.status === 'waiting' ? `
                        <div class="flex gap-2">
                            <button onclick="updateBetStatus(${bet.id}, 'triggered')" class="flex-1 bg-green-500 text-white py-2 rounded-lg text-sm font-medium active:scale-95 transition-all">
                                2Up ✓
                            </button>
                            <button onclick="updateBetStatus(${bet.id}, 'unsuccessful')" class="flex-1 bg-red-500 text-white py-2 rounded-lg text-sm font-medium active:scale-95 transition-all">
                                No 2Up ✗
                            </button>
                        </div>
                    ` : bet.status === 'triggered' ? `
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="mb-3">
                                <input type="number" id="closeExchangeOdds${bet.id}" class="w-full p-3 bg-white border border-gray-200 rounded-lg text-sm" step="0.01" placeholder="Exchange back odds">
                            </div>
                            <button onclick="closeBet(${bet.id})" class="w-full bg-ios-blue text-white py-2 rounded-lg text-sm font-medium active:scale-95 transition-all">
                                Calculate Profit
                            </button>
                        </div>
                    ` : bet.status === 'unsuccessful' ? `
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="text-center">
                                <div class="text-sm font-medium text-red-600">Loss: -£${bet.qualifyingLoss.toFixed(2)}</div>
                            </div>
                        </div>
                    ` : `
                        <div class="mt-3 pt-3 border-t border-gray-200">
                            <div class="text-center">
                                <div class="text-lg font-semibold ${bet.profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${bet.profit >= 0 ? '+' : ''}£${bet.profit.toFixed(2)}
                                </div>
                                <div class="text-xs text-gray-600 mt-1">
                                    Back: +£${(bet.backStake * (bet.bookieOdds - 1)).toFixed(2)} | Exchange: +£${(bet.layStake - (bet.backStake * bet.bookieOdds) / bet.closeExchangeOdds).toFixed(2)}
                                </div>
                            </div>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function updateSummary() {
            const totalBets = bets.length;
            const completedBets = bets.filter(b => b.status === 'completed' || b.status === 'unsuccessful').length;
            const totalQualifyingLoss = bets.reduce((sum, bet) => sum + bet.qualifyingLoss, 0);
            const totalProfit = bets.filter(b => b.status === 'completed' || b.status === 'unsuccessful').reduce((sum, bet) => sum + (bet.profit || 0), 0);

            document.getElementById('totalBets').textContent = totalBets;
            document.getElementById('completedBets').textContent = completedBets;
            document.getElementById('totalQualifyingLoss').textContent = `£${totalQualifyingLoss.toFixed(2)}`;
            document.getElementById('totalProfit').textContent = `£${totalProfit.toFixed(2)}`;
        }

        // Add event listeners for real-time calculation
        ['backStake', 'bookieOdds', 'exchangeOdds'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculateValues);
        });

        // Initialize
        renderBets();
        updateSummary();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9704280655d47719',t:'MTc1NTM4MTEyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
